#-------Sdet--------------------------------------------#

all: sdeta.vbe \
     sdetj.vbe \
     sdetm.vbe \
     sdeto.vbe \
     sdetr.vbe 
	     @echo "<-- Generated"

#-------Finite State Machine Synthesis-----------------#

vhd_to_fsm:
	rename .vhd .fsm *.vhd

sdeta.vbe: sdet.fsm
	@echo "    Encoding Synthesis -> sdeta.vbe"
	syf -CEV -a sdet
 
sdetj.vbe: sdet.fsm
	@echo "    Encoding Synthesis  -> sdetj.vbe"
	syf -CEV -j sdet
 
sdetm.vbe: sdet.fsm
	@echo "    Encoding Synthesis  -> sdetm.vbe"
	syf -CEV -m sdet
 
sdeto.vbe: sdet.fsm
	@echo "    Encoding Synthesis  -> sdeto.vbe"
	syf -CEV -o sdet
 
sdetr.vbe: sdet.fsm
	@echo "    Encoding Synthesis  -> sdetr.vbe"
	syf -CEV -r sdet

#-------Clean Up---------------------------------------#

clean :
	rm -f  *.vbe *.enc *~
	@echo "Erase all the files generated by the makefile"

#-------BOOM-------------------------------------------#

sdet_boom: sdeta_b.vbe sdetj_b.vbe sdetm_b.vbe sdeto_b.vbe sdetr_b.vbe

%_b.vbe: %.vbe
	@echo "    Boolean Optimization  -> $@"
	boom -V -d 50 $* $*_b > $*_boom.out

#-------BOOG-------------------------------------------#

sdet_boog: sdeta_b.vst sdetj_b.vst sdetm_b.vst sdeto_b.vst sdetr_b.vst

%.vst: %.vbe paramfile.lax
	@echo "    Logical Synthesis  -> $@"
	boog -x 1 -l paramfile $* > $*_boog.out

#-------LOON------------------------------------------#

sdet_loon: sdeta_b_l.vst sdetj_b_l.vst sdetm_b_l.vst sdeto_b_l.vst sdetr_b_l.vst

%_l.vst: %.vst paramfile.lax
	@echo "    Netlist Optimization  -> $@"
	loon -x 1 $* $*_l paramfile > $*_loon.out

#-------Flatbeh&Proof---------------------------------#

%_b_l_net.vbe: %_b_l.vst %.vbe
	@echo "    Formal checking  -> $@"
	flatbeh $*_b_l $*_b_l_net > $*_flatbeh.out
	proof -d $* $*_b_l_net > $*_proof.out

#-------scapin---------------------------------------#

ac_scapin_registers:
	cat sdetj_b_l.vst | grep sff

%_scan.vst: %.vst scan.path
	@echo "    scan-path insertion  -> $@"
	scapin -VRB $* scan $*_scan > scapin.out


#---------------------- ocp------------------------#

sdet_p_ap.ap : sdet.ioc sdetj_b_l_scan.vst
	MBK_IN_LO=vst; export MBK_IN_LO;\
	MBK_OUT_PH=ap; export MBK_OUT_PH;\
	ocp -v -ring -ioc sdet sdetj_b_l_scan sdet_p > ocp.out

#----------------------- nero------------------#
nero.ap: sdet_p.ap sdetj_b_l_scan.vst
	nero -V -p sdet_p sdetj_b_l_scan sdetj_b_l_scan > nero.out


#---------------------- ivx & cougar --------- #

%.al : %.ap
	MBK_OUT_LO=al; export MBK_OUT_LO;\
	RDS_TECHNO_NAME=./techno/techno-035.rds;\
	export RDS_TECHNO_NAME;\
	cougar -v $* > cougar_$*.out
	lvx vst al $* $* -f > lvx_$*.out

#----------------- druc--------------------#
druc_core : sdetj_b_l_scan.ap
	RDS_TECHNO_NAME=./techno/techno-symb.rds;\
	export RDS_TECHNO_NAME;\
	druc sdetj_b_l_scan > druc_core.out
#------------- s2r------------------------#
sdet_chip.cif : sdetj_b_l_scan.ap
	RDS_TECHNO_NAME=./techno/techno-035.rds;\
	export RDS_TECHNO_NAME;\
	RDS_OUT=cif; export RDS_OUT;\
	s2r -v -r sdetj_b_l_scan > s2r.out

